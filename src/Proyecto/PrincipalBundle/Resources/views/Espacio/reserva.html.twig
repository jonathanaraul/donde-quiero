{% extends "ProyectoPrincipalBundle:Default:base.html.twig" %}

{%block estilos%}
<link href='{{ asset('sistema/fullcalendar-1.6.4/fullcalendar/fullcalendar.css')}}' rel='stylesheet' />
<link href='{{ asset('sistema/fullcalendar-1.6.4/fullcalendar/fullcalendar.print.css')}}' rel='stylesheet' media='print' />

<style>
	body {
		margin-top: 40px;
		text-align: center;
		font-size: 14px;
		font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
	}
	.fc-event {
		#border: 1px solid #000000;
		background-color: #1EAC18;
	}
	#calendar {
		width: 700px;
		margin: 0 auto;
		background-color: white;
		margin-top: 20px;
		/* padding-top: 20px; */
		/* margin-top: 20px; */
		margin-bottom: 20px;
		padding: 20px;
		border-radius: 15px;
		-moz-border-radius: 15px;
		-webkit-box-shadow: 0 1px 3px #c3c3c3;
		-moz-box-shadow: 0 1px 3px #c3c3c3;
		box-shadow: 0 1px 3px #c3c3c3;
		-webkit-transition: box-shadow 0.2s ease-in-out;
		-moz-transition: box-shadow 0.2s ease-in-out;
		-o-transition: box-shadow 0.2s ease-in-out;
		-ms-transition: box-shadow 0.2s ease-in-out;
		transition: box-shadow 0.2s ease-in-out;
	}
	.external-event {
		background-color: rgb(30, 172, 24);
		color: rgb(241, 241, 240);
		cursor: pointer;
	}

</style>
{%endblock%}

{%block scripts%}

<script type="text/javascript" src="{{ asset('sistema/scripts/reservas.js')}}"></script> 
<script src='{{ asset('sistema/fullcalendar-1.6.4/lib/jquery.min.js')}}'></script>
<script src='{{ asset('sistema/fullcalendar-1.6.4/lib/jquery-ui.custom.min.js')}}'></script>
<script src='{{ asset('sistema/fullcalendar-1.6.4/fullcalendar/fullcalendar.min.js')}}'></script>

<script type="text/javascript">

var direccionProcesarReserva = "{{path('proyecto_principal_espacio_procesar_reserva')}}";
var direccionBorrarReservas = "{{path('proyecto_principal_espacio_borrar_reservas')}}";
var direccionReservarEspacio = "{{path('proyecto_principal_espacio_reservar',{'id':object.id})}}";


</script>

<script>
	$(document).ready(function() {

		var date = new Date();
		var d = date.getDate();
		var m = date.getMonth();
		var y = date.getFullYear();

		$('#external-events div.external-event').each(function() {

			// create an Event Object (http://arshaw.com/fullcalendar/docs/event_data/Event_Object/)
			// it doesn't need to have a start or end
			var eventObject = {
				title : $.trim($(this).text()) // use the element's text as the event title
			};

			// store the Event Object in the DOM element so we can get to it later
			$(this).data('eventObject', eventObject);

			// make the event draggable using jQuery UI
			$(this).draggable({
				zIndex : 999,
				revert : true, // will cause the event to go back to its
				revertDuration : 0 //  original position after the drag
			});

		});
		$('#calendar').fullCalendar({
			header : {
				left : 'prev,next today',
				center : 'title',
				right : 'month,agendaDay'
			},
			editable : true,
			droppable : true, // this allows things to be dropped onto the calendar !!!
			allDayText : 'Todo el día (24 horas)',
			buttonText : {

				today : 'Hoy',
				month : 'Mes',
				week : 'Semana',
				day : 'Día'
			},
			dayNames : ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sabado'],
			dayNamesShort : ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'],
			monthNamesShort : ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
			events : [
            {%for element in reservas%}
			{
				title : '{{element.titulo}}',
				start : new Date({{element.fechaInicio.format('Y')}}, {{element.fechaInicio.format('m')}} -1, {{element.fechaInicio.format('d')}}),
				end : new Date({{element.fechaFin.format('Y')}}, {{element.fechaInicio.format('m')}} -1, {{element.fechaFin.format('d')}}),
				editable : false,
				allDay : true,
				color : 'Red', // an option!
				textColor : 'White'
			},
            {%endfor%}
 
			{
				title : 'Día no laborable',
				start : new Date(y, m, d + 5, 17, 0),
				end : new Date(y, m, d + 5, 18, 0),
				editable : false,
				allDay : true,
				color : 'Yellow', // an option!
				textColor : 'Black'
			}],

			drop : function(date, allDay) {// this function is called when something is dropped

				// retrieve the dropped element's stored Event Object
				var originalEventObject = $(this).data('eventObject');
				// we need to copy it, so that multiple events don't have a reference to the same object
				var evento = $.extend({}, originalEventObject);
				// assign it the date that was reported
				evento.start = date;
				evento.allDay = allDay;

				$('#titulo').attr('value',evento.title);

				$('#anioInicio').attr('value',evento.start.getFullYear());
				$('#mesInicio').attr('value',evento.start.getMonth());
				$('#diaInicio').attr('value',evento.start.getDate());
				$('#horaInicio').attr('value',evento.start.getHours());
				$('#minInicio').attr('value',evento.start.getMinutes());

				$('#anioFin').attr('value',evento.start.getFullYear());
				$('#mesFin').attr('value',evento.start.getMonth());
				$('#diaFin').attr('value',evento.start.getDate());
				$('#horaFin').attr('value',evento.start.getHours());
				$('#minFin').attr('value',evento.start.getMinutes());

				$('#todoDia').attr('value',true);

				$('#numeroReservacion').attr('value',$(this).attr('numeroReservacion'));


				
				$('#calendar').fullCalendar('renderEvent', evento, true);
                console.dir(evento);

				$(this).remove();
                actualizaBD();
			},
			eventDrop : function(event, delta) {
				var evento = event;
				console.dir(delta);

				console.dir(event);

				$('#anioInicio').attr('value',evento.start.getFullYear());
				$('#mesInicio').attr('value',evento.start.getMonth());
				$('#diaInicio').attr('value',evento.start.getDate());
				$('#horaInicio').attr('value',evento.start.getHours());
				$('#minInicio').attr('value',evento.start.getMinutes());

                if(evento.end != null){
				$('#mesFin').attr('value',evento.end.getMonth());
				$('#diaFin').attr('value',evento.end.getDate());
				$('#horaFin').attr('value',evento.end.getHours());
				$('#minFin').attr('value',evento.end.getMinutes());
                }
                else{
				$('#mesFin').attr('value',evento.start.getMonth());
				$('#diaFin').attr('value',evento.start.getDate());
				$('#horaFin').attr('value',evento.start.getHours());
				$('#minFin').attr('value',evento.start.getMinutes());
                }


				actualizaBD();

				console.log(event.title + ' was moved ' + delta + ' days\n' +'(should probably update your database) el dia de inicio'+diaInicio);
			},
			eventResize: function(event,dayDelta,minuteDelta,revertFunc) {

				var evento = event;
				console.dir(event);

				$('#anioInicio').attr('value',evento.start.getFullYear());
				$('#mesInicio').attr('value',evento.start.getMonth());
				$('#diaInicio').attr('value',evento.start.getDate());
				$('#horaInicio').attr('value',evento.start.getHours());
				$('#minInicio').attr('value',evento.start.getMinutes());
                
                if(evento.end != null){
				$('#anioFin').attr('value',evento.end.getFullYear());
				$('#mesFin').attr('value',evento.end.getMonth());
				$('#diaFin').attr('value',evento.end.getDate());
				$('#horaFin').attr('value',evento.end.getHours());
				$('#minFin').attr('value',evento.end.getMinutes());
                }
                else{
				$('#mesFin').attr('value',evento.start.getMonth());
				$('#diaFin').attr('value',evento.start.getDate());
				$('#horaFin').attr('value',evento.start.getHours());
				$('#minFin').attr('value',evento.start.getMinutes());
                }

				actualizaBD();

			},
		});

	});

</script>

{%endblock%}

{%block contenedorbase%}
<div class="wrapper">

	{% include 'ProyectoPrincipalBundle:Helpers:top.html.twig'  with {'clase': 'verde'}  %}
	{% include 'ProyectoPrincipalBundle:Default:sesion.html.twig'  with {'datos': datos} %}

	<aside id="about" class=" left">
		<!-- Text Section Start -->
		<!-- Replace all text with what you want -->
		<div style="position:relative;">
			<ul id="gallery">
				<li>
					<img src="{{ asset('uploads/espacios/'~ object.path  ) }}" alt="" style="width:270px;height:230px;">

				</li>
				<li>
					{#<img src="{{ asset('sistema/images/work/thumbs/triangulo2.png')}}" alt="" />#}
				</li>
				<li>
					{#<img src="{{ asset('sistema/images/work/thumbs/triangulo3.png')}}"  alt="" />#}
				</li>

			</ul>
		</div>
		<div class="clearfix"></div>

	</aside>
	<aside class="right">

		<div class="fichaizq">
			<h3>{{object.nombre|title}}</h3>
			{#
			<ul>
				<li class="izquierda">
					<h4><a href="sede.html">La Sede del Coam.</a></h4>
				</li>
				<li class="derecha">
					<h4><a href="sede.html" style="margin-left:5px">Cómo llegar.</a></h4>
				</li>
			</ul><!--Category-->
			#}
			<div class="clearfix"></div>
			<p>
				{{object.descripcionGeneral}}

				Este espacio esta disponible para su reservacion segun los siguientes parametros:...
			</p>

		</div>

		<div class="clearfix"></div>

		<div class="clearfix"></div>

		<!-- Text Section End -->
	</aside>
	<div class="clearfix" ></div>
	<!-- Text Section End -->

	<div class="verde rejilla-espacios" id="work" paginacion="">

        <input type="hidden" id="tipo" value="espacio" class="codigos">
		<input type="hidden" id="idTipo" value="{{object.id}}" class="codigos">

		<input type="hidden" id="anioInicio" value="" class="codigos">
		<input type="hidden" id="mesInicio" value="" class="codigos">
		<input type="hidden" id="diaInicio" value="" class="codigos">
		<input type="hidden" id="horaInicio" value="" class="codigos">
		<input type="hidden" id="minInicio" value="" class="codigos">

		<input type="hidden" id="anioFin" value="" class="codigos">
		<input type="hidden" id="mesFin" value="" class="codigos">
		<input type="hidden" id="diaFin" value="" class="codigos">
		<input type="hidden" id="horaFin" value="" class="codigos">
		<input type="hidden" id="minFin" value="" class="codigos">

		<input type="hidden" id="numeroReservacion" value="{{numeroReservacion}}" class="codigos">
		<input type="hidden" id="titulo" value="" class="codigos">
        <input type="hidden" id="todoDia" value="" class="codigos">

		<!-- Work Links Section Start -->
		<div class="añadir">
			<a href="/donde-quiero/web/app_dev.php/espacios">Reserva</a><!--/item-->
		</div>
		<!--/item-->
		<div class="buscador" style="height: 42px;float: right;margin-right: 27px;width: 300px;">
			<div id='external-events'>
				<h4>Seleccione y arrastre al calendario su reserva</h4>
				<div class='external-event' user="{{datos.usuario}}" numeroReservacion="{{numeroReservacion}}">
					Mi Reserva
				</div>
			</div>
		</div>
		<!--/item-->

		<!--/item-->

		<!--/item--><!--/item--><!--/item-->

		<!--/item-->

		<!--/item-->

		<!--/item-->
		<div class="clearfix" ></div>
		<div id="elementos-espacio-verde">

			<div id='calendar'></div>
			<div style='clear:both'></div>
		</div>
		<div class="clearfix"></div>

		<div class="buscador" style="float: left;width: 218px;margin-left: 27px;">
			<div class="enviar">
				<a href="javascript:void(0)" title="Borrar reservas" id="botonBorrarReservas" >Borrar todas mis reservas</a>
			</div>
		</div>
		<div class="buscador" style="float: left;width: 218px;margin-left: 70px;">
			<div class="enviar">
				<a href="{{path('proyecto_principal_espacio_reservar',{'id':object.id})}}" title="Reservar ahora" >Reservar fecha adicional</a>
			</div>
		</div>

		<div class="buscador" style="float: right;width: 126px;margin-right: 27px;">
			<div class="enviar">
				<a href="{{ url('proyecto_principal_espacio_confirmacion', {'id': object.id }) }}" title="Siguiente" id="botonContinuarReserva">Siguiente</a>
			</div>
		</div>
		<div class="clearfix"></div>
		<div id="loader-widget-verde" style="display:none;height:260px;">
			<p style="text-align:center;width: 100%;margin-top: 168px;"><img src="{{ asset('sistema/images/loader-verde.gif')}}" title="Procesando" style="width:80px;">
			</p>
		</div>
	</div>
	<!-- Work Links Section End -->

	<div class="clearfix"></div>
</div><!--/html_carousel-->

{%endblock%} 